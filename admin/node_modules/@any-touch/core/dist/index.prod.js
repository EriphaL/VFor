"use strict";function _interopDefault(t){return t&&"object"==typeof t&&"default"in t?t.default:t}Object.defineProperty(exports,"__esModule",{value:!0});var tslib=require("tslib"),AnyEvent=_interopDefault(require("any-event")),shared=require("@any-touch/shared"),default_1=function(){},default_1$1=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return tslib.__extends(e,t),e.prototype.load=function(t){var e=[],n=Array.from(t.touches).map((function(t){var n=t.clientX,r=t.clientY,i=t.target;return e.push(i),{clientX:n,clientY:r,target:i}})),r=Array.from(t.changedTouches).map((function(t){return{clientX:t.clientX,clientY:t.clientY,target:t.target}}));return{inputType:t.type.replace("touch",""),changedPoints:r,points:n,nativeEvent:t,target:t.target,targets:e}},e}(default_1),default_1$2=function(t){function e(){var e=t.call(this)||this;return e.target=null,e.isPressed=!1,e}return tslib.__extends(e,t),e.prototype.load=function(t){var e,n=t.clientX,r=t.clientY,i=t.type,a=t.button,s=t.target,o=[{clientX:n,clientY:r,target:s}];shared.MOUSE_DOWN===i&&0===a?(this.target=s,this.isPressed=!0,e=shared.INPUT_START):this.isPressed&&(shared.MOUSE_MOVE===i?e=shared.INPUT_MOVE:shared.MOUSE_UP===i&&(o=[],e=shared.INPUT_END,this.isPressed=!1));var u=this.prevPoints||[{clientX:n,clientY:r,target:s}];if(this.prevPoints=[{clientX:n,clientY:r,target:s}],void 0!==e)return{inputType:e,changedPoints:u,points:o,target:this.target,targets:[this.target],nativeEvent:t}},e}(default_1),default_1$3=function(){function t(){var t=shared.SUPPORT_TOUCH?default_1$1:default_1$2;this.adapter=new t,this.id=0}return t.prototype.transform=function(t){this.prevInput=this.activeInput;var e=this.adapter.load(t);if(void 0!==e){var n=Number.MAX_SAFE_INTEGER>this.id?++this.id:1,r=extendInput(tslib.__assign(tslib.__assign({},e),{id:n}));this.activeInput=r;var i=r.isStart,a=r.pointLength;return i&&(this.startInput=r,this.prevInput=void 0,this.startMultiInput=1<a?r:void 0),tslib.__assign(tslib.__assign({},r),{prevInput:this.prevInput,startMultiInput:this.startMultiInput,startInput:this.startInput})}},t}();function getCenter(t){var e=t.length;if(0<e){if(1===e){var n=t[0],r=n.clientX,i=n.clientY;return{x:Math.round(r),y:Math.round(i)}}var a=t.reduce((function(t,e){return t.x+=e[shared.CLIENT_X],t.y+=e[shared.CLIENT_Y],t}),{x:0,y:0});return{x:Math.round(a.x/e),y:Math.round(a.y/e)}}}function extendInput(t){var e=t.inputType,n=t.points,r=t.changedPoints,i=t.nativeEvent,a=n.length,s=shared.INPUT_START===e,o=shared.INPUT_END===e&&0===a||shared.INPUT_CANCEL===e,u=performance.now(),c=getCenter(n)||getCenter(r),l=c.x,d=c.y,p=i.currentTarget;return tslib.__assign(tslib.__assign({},t),{x:l,y:d,timestamp:u,isStart:s,isEnd:o,pointLength:a,currentTarget:p,getOffset:function(t){void 0===t&&(t=p);var e=t.getBoundingClientRect();return{x:l-Math.round(e.left),y:d-Math.round(e.top)}}})}function dispatchDomEvent(t,e,n){e.target,e.currentTarget;var r,i=e.type,a=tslib.__rest(e,["target","currentTarget","type"]);return"createEvent"in document?(r=document.createEvent("HTMLEvents")).initEvent(i,null==n?void 0:n.bubbles,null==n?void 0:n.cancelable):r=new Event(i,n),Object.assign(r,a,{match:function(){return e.targets.every((function(t){return r.currentTarget.contains(t)}))}}),t.dispatchEvent(r)}function canPreventDefault(t,e){if(!e.isPreventDefault)return!1;var n=!0;if(null!==t.target){var r=e.preventDefaultExclude;if(shared.isRegExp(r)){if("tagName"in t.target){var i=t.target.tagName;n=!r.test(i)}}else shared.isFunction(r)&&(n=!r(t))}return n}var TOUCH_EVENT_NAMES=[shared.TOUCH_START,shared.TOUCH_MOVE,shared.TOUCH_END,shared.TOUCH_CANCEL];function bindElement(t,e,n){return shared.SUPPORT_TOUCH?(TOUCH_EVENT_NAMES.forEach((function(r){t.addEventListener(r,e,n)})),function(){TOUCH_EVENT_NAMES.forEach((function(n){t.removeEventListener(n,e)}))}):(t.addEventListener(shared.MOUSE_DOWN,e,n),window.addEventListener(shared.MOUSE_MOVE,e,n),window.addEventListener(shared.MOUSE_UP,e,n),function(){t.removeEventListener(shared.MOUSE_DOWN,e),window.removeEventListener(shared.MOUSE_MOVE,e),window.removeEventListener(shared.MOUSE_UP,e)})}function use(t,e,n){var r=null==n?void 0:n.name;if(void 0===r||void 0===t.recognizerMap[r]){var i=new e(n);t.recognizerMap[i.name]=i,i.recognizerMap=t.recognizerMap,t.recognizers.push(t.recognizerMap[i.name])}}function removeUse(t,e){var n,r;if(void 0===e)t.recognizers=[],t.recognizerMap={};else try{for(var i=tslib.__values(t.recognizers.entries()),a=i.next();!a.done;a=i.next()){var s=tslib.__read(a.value,2),o=s[0];if(e===s[1].options.name){t.recognizers.splice(o,1),delete t.recognizerMap[e];break}}}catch(t){n={error:t}}finally{try{a&&!a.done&&(r=i.return)&&r.call(i)}finally{if(n)throw n.error}}}function emit2(t,e){var n=e.type,r=e.target,i=e.targets;t.emit(n,e,(function(t){if(void 0!==(null==t?void 0:t.target)){var e=t.target;return i.every((function(t){return e.contains(t)}))}return!0}));t.emit("at:after",e),t.options.domEvents&&void 0!==t.el&&null!==r&&(dispatchDomEvent(r,e,t.options.domEvents),dispatchDomEvent(r,tslib.__assign(tslib.__assign({},e),{type:"at:after"}),t.options.domEvents))}var DEFAULT_OPTIONS={domEvents:{bubbles:!0,cancelable:!0},isPreventDefault:!0,preventDefaultExclude:/^(?:INPUT|TEXTAREA|BUTTON|SELECT)$/},AnyTouch=function(t){function e(n,r){var i=t.call(this)||this;if(i.recognizerMap={},i.recognizers=[],i.cacheComputedFunctionGroup=Object.create(null),i.el=n,i.input=new default_1$3,i.options=tslib.__assign(tslib.__assign({},DEFAULT_OPTIONS),r),i.recognizerMap=e.recognizerMap,i.recognizers=e.recognizers,void 0!==n){n.style.webkitTapHighlightColor="rgba(0,0,0,0)";var a=!1;try{var s={};Object.defineProperty(s,"passive",{get:function(){a=!0}}),window.addEventListener("_",(function(){}),s)}catch(t){}i.on("unbind",bindElement(n,i.catchEvent.bind(i),!(i.options.isPreventDefault||!a)&&{passive:!0}))}return i}return tslib.__extends(e,t),e.prototype.use=function(t,e){use(this,t,e)},e.prototype.removeUse=function(t){removeUse(this,t)},e.prototype.catchEvent=function(t){var e,n,r=this;canPreventDefault(t,this.options)&&t.preventDefault();var i=this.input.transform(t);if(void 0!==i){var a="at:"+shared.TOUCH,s=a+i.inputType;this.emit(a,i),this.emit(s,i);var o=this.options.domEvents;if(!1!==o){var u=t.target;null!==u&&(dispatchDomEvent(u,tslib.__assign(tslib.__assign({},i),{type:a}),o),dispatchDomEvent(u,tslib.__assign(tslib.__assign({},i),{type:s}),o))}var c=Object.create(null),l=function(t){if(t.disabled)return"continue";t.computedGroup=c,t.computeFunctionMap=d.cacheComputedFunctionGroup,t.recognize(i,(function(e,n){var a=tslib.__assign(tslib.__assign(tslib.__assign({},i),n),{type:e,baseType:t.name});Object.freeze(a),void 0===r.beforeEachHook?emit2(r,a):r.beforeEachHook(t,(function(){emit2(r,a)}))})),c=t.computedGroup,d.cacheComputedFunctionGroup=t.computeFunctionMap},d=this;try{for(var p=tslib.__values(this.recognizers),v=p.next();!v.done;v=p.next()){l(v.value)}}catch(t){e={error:t}}finally{try{v&&!v.done&&(n=p.return)&&n.call(p)}finally{if(e)throw e.error}}}},e.prototype.beforeEach=function(t){this.beforeEachHook=t},e.prototype.get=function(t){return this.recognizerMap[t]},e.prototype.set=function(t){this.options=tslib.__assign(tslib.__assign({},this.options),t)},e.prototype.destroy=function(){this.emit("unbind"),this.listenersMap={}},e.version="0.7.1",e.recognizers=[],e.recognizerMap={},e.use=function(t,n){use(e,t,n)},e.removeUse=function(t){removeUse(e,t)},e}(AnyEvent);exports.default=AnyTouch;
