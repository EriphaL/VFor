"use strict";function _interopDefault(t){return t&&"object"==typeof t&&"default"in t?t.default:t}Object.defineProperty(exports,"__esModule",{value:!0});var tslib=require("tslib"),shared=require("@any-touch/shared"),Recognizer=_interopDefault(require("@any-touch/recognizer")),vector=require("@any-touch/vector"),compute=require("@any-touch/compute"),DEFAULT_OPTIONS={name:"tap",pointLength:1,tapTimes:1,waitNextTapTime:300,maxDistance:2,maxDistanceFromPrevTap:9,maxPressTime:250},default_1=function(t){function e(e){var i=t.call(this,tslib.__assign(tslib.__assign({},DEFAULT_OPTIONS),e))||this;return i.tapCount=0,i}return tslib.__extends(e,t),e.prototype._isValidDistanceFromPrevTap=function(t){if(void 0!==this.prevTapPoint){var e=vector.getVLength({x:t.x-this.prevTapPoint.x,y:t.y-this.prevTapPoint.y});return this.prevTapPoint=t,this.options.maxDistanceFromPrevTap>=e}return this.prevTapPoint=t,!0},e.prototype._isValidInterval=function(){var t=performance.now();if(void 0===this.prevTapTime)return this.prevTapTime=t,!0;var e=t-this.prevTapTime;return this.prevTapTime=t,e<this.options.waitNextTapTime},e.prototype.recognize=function(t,e){var i=t.inputType,o=t.x,s=t.y;this.computed=this.compute([compute.ComputeMaxLength,compute.ComputeDistance],t),shared.INPUT_END===i&&(this.status=shared.STATUS_POSSIBLE,this.test(t)?(this.cancelCountDownToFail(),this._isValidDistanceFromPrevTap({x:o,y:s})&&this._isValidInterval()?this.tapCount++:this.tapCount=1,0==this.tapCount%this.options.tapTimes?(this.status=shared.STATUS_RECOGNIZED,e(this.options.name,tslib.__assign(tslib.__assign({},this.computed),{tapCount:this.tapCount})),this.reset()):this.countDownToFail()):(this.reset(),this.status=shared.STATUS_FAILED))},e.prototype.countDownToFail=function(){var t=this;this._countDownToFailTimer=setTimeout((function(){t.status=shared.STATUS_FAILED,t.reset()}),this.options.waitNextTapTime)},e.prototype.cancelCountDownToFail=function(){clearTimeout(this._countDownToFailTimer)},e.prototype.reset=function(){this.tapCount=0,this.prevTapPoint=void 0,this.prevTapTime=void 0},e.prototype.test=function(t){var e=t.startInput,i=t.pointLength,o=t.timestamp-e.timestamp,s=this.computed,n=s.maxPointLength,a=s.distance;return n===this.options.pointLength&&0===i&&this.options.maxDistance>=a&&this.options.maxPressTime>o},e}(Recognizer);exports.default=default_1;
