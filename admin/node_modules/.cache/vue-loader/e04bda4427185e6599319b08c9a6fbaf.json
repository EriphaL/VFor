{"remainingRequest":"/Users/eripha/Desktop/project/routine/admin/node_modules/vue-loader/lib/index.js??vue-loader-options!/Users/eripha/Desktop/project/routine/admin/src/components/BarChart.vue?vue&type=script&lang=js&","dependencies":[{"path":"/Users/eripha/Desktop/project/routine/admin/src/components/BarChart.vue","mtime":1593395785985},{"path":"/Users/eripha/Desktop/project/routine/admin/node_modules/cache-loader/dist/cjs.js","mtime":499162500000},{"path":"/Users/eripha/Desktop/project/routine/admin/node_modules/babel-loader/lib/index.js","mtime":499162500000},{"path":"/Users/eripha/Desktop/project/routine/admin/node_modules/cache-loader/dist/cjs.js","mtime":499162500000},{"path":"/Users/eripha/Desktop/project/routine/admin/node_modules/vue-loader/lib/index.js","mtime":499162500000}],"contextDependencies":[],"result":[{"type":"Buffer","data":"base64:Ly8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KCmltcG9ydCB7IHNjYWxlTGluZWFyLCBzY2FsZUJhbmQgfSBmcm9tICJkMy1zY2FsZSI7CmltcG9ydCB7IG1heCwgbWluIH0gZnJvbSAiZDMtYXJyYXkiOwppbXBvcnQgeyBzZWxlY3RBbGwgfSBmcm9tICJkMy1zZWxlY3Rpb24iOwovLyBpbXBvcnQgeyB0cmFuc2l0aW9uIH0gZnJvbSAiZDMtdHJhbnNpdGlvbiI7CgpleHBvcnQgZGVmYXVsdCB7CiAgbmFtZTogIkJhckNoYXJ0IiwKICBwcm9wczogewogICAgdGl0bGU6IFN0cmluZywKICAgIHhLZXk6IFN0cmluZywKICAgIHlLZXk6IFN0cmluZywKICAgIGRhdGE6IEFycmF5CiAgfSwKICBtb3VudGVkKCkgewogICAgdGhpcy5zdmdXaWR0aCA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCJjb250YWluZXIiKS5vZmZzZXRXaWR0aCAqIDAuNzU7CiAgICB0aGlzLkFkZFJlc2l6ZUxpc3RlbmVyKCk7CiAgICB0aGlzLkFuaW1hdGVMb2FkKCk7CiAgfSwKICBkYXRhOiAoKSA9PiAoewogICAgc3ZnV2lkdGg6IDAsCiAgICByZWRyYXdUb2dnbGU6IHRydWUKICB9KSwKICBtZXRob2RzOiB7CiAgICAvLyDnu5jliLbmn7HlvaIKICAgIEFuaW1hdGVMb2FkKCkgewogICAgICBzZWxlY3RBbGwoInJlY3QiKQogICAgICAgIC5kYXRhKHRoaXMuZGF0YSkKICAgICAgICAudHJhbnNpdGlvbigpCiAgICAgICAgLmRlbGF5KChkLCBpKSA9PiB7CiAgICAgICAgICByZXR1cm4gaSAqIDE1MDsKICAgICAgICB9KQogICAgICAgIC5kdXJhdGlvbigxMDAwKQogICAgICAgIC5hdHRyKCJ5IiwgZCA9PiB7CiAgICAgICAgICByZXR1cm4gdGhpcy55U2NhbGUoZFt0aGlzLnlLZXldKTsKICAgICAgICB9KQogICAgICAgIC5hdHRyKCJoZWlnaHQiLCBkID0+IHsKICAgICAgICAgIHJldHVybiB0aGlzLnN2Z0hlaWdodCAtIHRoaXMueVNjYWxlKGRbdGhpcy55S2V5XSk7CiAgICAgICAgfSkKICAgICAgICAuZGF0YSh0aGlzLmRhdGEpCiAgICAgICAgLmVudGVyKCk7CiAgICB9LAogICAgLy8g6LCD5pW056qX5Y+j5aSn5bCP5ZCOMzAw5q+r56eS6YeN5paw57uY5Yi25Zu+6KGoCiAgICAvLyDljbPlk43lupTlvI/nu5jliLYKICAgIEFkZFJlc2l6ZUxpc3RlbmVyKCkgewogICAgICB3aW5kb3cuYWRkRXZlbnRMaXN0ZW5lcigicmVzaXplIiwgKCkgPT4gewogICAgICAgIHRoaXMuJGRhdGEucmVkcmF3VG9nZ2xlID0gZmFsc2U7CiAgICAgICAgc2V0VGltZW91dCgoKSA9PiB7CiAgICAgICAgICB0aGlzLiRkYXRhLnJlZHJhd1RvZ2dsZSA9IHRydWU7CiAgICAgICAgICB0aGlzLiRkYXRhLnN2Z1dpZHRoID0KICAgICAgICAgICAgZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoImNvbnRhaW5lciIpLm9mZnNldFdpZHRoICogMC43NTsKICAgICAgICAgIHRoaXMuQW5pbWF0ZUxvYWQoKTsKICAgICAgICB9LCAzMDApOwogICAgICB9KTsKICAgICAgY29uc29sZS5sb2codGhpcy5zdmdXaWR0aCk7CiAgICB9CiAgfSwKICBjb21wdXRlZDogewogICAgZGF0YU1heCgpIHsKICAgICAgcmV0dXJuIG1heCh0aGlzLmRhdGEsIGQgPT4gewogICAgICAgIHJldHVybiBkW3RoaXMueUtleV07CiAgICAgIH0pOwogICAgfSwKICAgIGRhdGFNaW4oKSB7CiAgICAgIHJldHVybiBtaW4odGhpcy5kYXRhLCBkID0+IHsKICAgICAgICByZXR1cm4gZFt0aGlzLnlLZXldOwogICAgICB9KTsKICAgIH0sCiAgICB4U2NhbGUoKSB7CiAgICAgIHJldHVybiBzY2FsZUJhbmQoKQogICAgICAgIC5yYW5nZVJvdW5kKFswLCB0aGlzLnN2Z1dpZHRoXSkKICAgICAgICAucGFkZGluZygwLjEpCiAgICAgICAgLmRvbWFpbigKICAgICAgICAgIHRoaXMuZGF0YS5tYXAoZCA9PiB7CiAgICAgICAgICAgIHJldHVybiBkW3RoaXMueEtleV07CiAgICAgICAgICB9KQogICAgICAgICk7CiAgICB9LAogICAgLy8g6YCa6L+H57q/5oCn5q+U5L6L5bC66Ieq5Yqo55Sf5oiQCiAgICB5U2NhbGUoKSB7CiAgICAgIHJldHVybiBzY2FsZUxpbmVhcigpCiAgICAgICAgLnJhbmdlUm91bmQoW3RoaXMuc3ZnSGVpZ2h0LCAwXSkKICAgICAgICAuZG9tYWluKFt0aGlzLmRhdGFNaW4gPiAwID8gMCA6IHRoaXMuZGF0YU1pbiArIDIsIHRoaXMuZGF0YU1heCArIDJdKTsKICAgIH0sCgogICAgc3ZnSGVpZ2h0KCkgewogICAgICByZXR1cm4gdGhpcy5zdmdXaWR0aCAvIDEuNjE4MDMzOTg4NzU7IC8vIOm7hOmHkeavlOS+iwogICAgfQogIH0KfTsK"},{"version":3,"sources":["BarChart.vue"],"names":[],"mappings":";;;;;;;;;;;;;;;;;;;;;;;;;;;;AA4BA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA","file":"BarChart.vue","sourceRoot":"src/components","sourcesContent":["<template>\n  <div id=\"container\" class=\"svg-container\" align=\"center\">\n    <h1>{{ title }}</h1>\n    <svg v-if=\"redrawToggle === true\" :width=\"svgWidth\" :height=\"svgHeight\">\n      <g>\n        <text\n          v-for=\"item in data\"\n          :key=\"item[xKey].amount\"\n          :x=\"xScale(item[xKey]) + 30\"\n          :y=\"yScale(item[yKey]) - 2\"\n          fill=\"red\"\n        >{{ item[xKey]}} {{ item[yKey]}}</text>\n\n        <rect\n          v-for=\"item in data\"\n          class=\"bar-positive\"\n          :key=\"item[xKey]\"\n          :x=\"xScale(item[xKey])\"\n          :y=\"yScale(0)\"\n          :width=\"xScale.bandwidth()\"\n          :height=\"0\"\n        />\n      </g>\n    </svg>\n  </div>\n</template>\n\n<script>\nimport { scaleLinear, scaleBand } from \"d3-scale\";\nimport { max, min } from \"d3-array\";\nimport { selectAll } from \"d3-selection\";\n// import { transition } from \"d3-transition\";\n\nexport default {\n  name: \"BarChart\",\n  props: {\n    title: String,\n    xKey: String,\n    yKey: String,\n    data: Array\n  },\n  mounted() {\n    this.svgWidth = document.getElementById(\"container\").offsetWidth * 0.75;\n    this.AddResizeListener();\n    this.AnimateLoad();\n  },\n  data: () => ({\n    svgWidth: 0,\n    redrawToggle: true\n  }),\n  methods: {\n    // 绘制柱形\n    AnimateLoad() {\n      selectAll(\"rect\")\n        .data(this.data)\n        .transition()\n        .delay((d, i) => {\n          return i * 150;\n        })\n        .duration(1000)\n        .attr(\"y\", d => {\n          return this.yScale(d[this.yKey]);\n        })\n        .attr(\"height\", d => {\n          return this.svgHeight - this.yScale(d[this.yKey]);\n        })\n        .data(this.data)\n        .enter();\n    },\n    // 调整窗口大小后300毫秒重新绘制图表\n    // 即响应式绘制\n    AddResizeListener() {\n      window.addEventListener(\"resize\", () => {\n        this.$data.redrawToggle = false;\n        setTimeout(() => {\n          this.$data.redrawToggle = true;\n          this.$data.svgWidth =\n            document.getElementById(\"container\").offsetWidth * 0.75;\n          this.AnimateLoad();\n        }, 300);\n      });\n      console.log(this.svgWidth);\n    }\n  },\n  computed: {\n    dataMax() {\n      return max(this.data, d => {\n        return d[this.yKey];\n      });\n    },\n    dataMin() {\n      return min(this.data, d => {\n        return d[this.yKey];\n      });\n    },\n    xScale() {\n      return scaleBand()\n        .rangeRound([0, this.svgWidth])\n        .padding(0.1)\n        .domain(\n          this.data.map(d => {\n            return d[this.xKey];\n          })\n        );\n    },\n    // 通过线性比例尺自动生成\n    yScale() {\n      return scaleLinear()\n        .rangeRound([this.svgHeight, 0])\n        .domain([this.dataMin > 0 ? 0 : this.dataMin + 2, this.dataMax + 2]);\n    },\n\n    svgHeight() {\n      return this.svgWidth / 1.61803398875; // 黄金比例\n    }\n  }\n};\n</script>\n\n<style scoped>\n.bar-positive {\n  fill: steelblue;\n  transition: r 0.2s ease-in-out;\n}\n\n.bar-positive:hover {\n  fill: brown;\n}\n\n.svg-container {\n  display: inline-block;\n  position: relative;\n  width: 100%;\n  padding-bottom: 1%;\n  vertical-align: top;\n  overflow: hidden;\n}\n</style>\n"]}]}