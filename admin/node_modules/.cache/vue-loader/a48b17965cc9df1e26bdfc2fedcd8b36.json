{"remainingRequest":"/Users/eripha/Desktop/project/routine/admin/node_modules/vue-loader/lib/index.js??vue-loader-options!/Users/eripha/Desktop/project/routine/admin/src/components/Call.vue?vue&type=script&lang=js&","dependencies":[{"path":"/Users/eripha/Desktop/project/routine/admin/src/components/Call.vue","mtime":1593398360740},{"path":"/Users/eripha/Desktop/project/routine/admin/node_modules/cache-loader/dist/cjs.js","mtime":499162500000},{"path":"/Users/eripha/Desktop/project/routine/admin/node_modules/babel-loader/lib/index.js","mtime":499162500000},{"path":"/Users/eripha/Desktop/project/routine/admin/node_modules/cache-loader/dist/cjs.js","mtime":499162500000},{"path":"/Users/eripha/Desktop/project/routine/admin/node_modules/vue-loader/lib/index.js","mtime":499162500000}],"contextDependencies":[],"result":[{"type":"Buffer","data":"base64:Ly8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KCmltcG9ydCB7IHNjYWxlTGluZWFyLCBzY2FsZUJhbmQgfSBmcm9tICJkMy1zY2FsZSI7CmltcG9ydCB7IG1heCwgbWluIH0gZnJvbSAiZDMtYXJyYXkiOwppbXBvcnQgeyBzZWxlY3RBbGwgfSBmcm9tICJkMy1zZWxlY3Rpb24iOwppbXBvcnQgeyB0cmFuc2l0aW9uIH0gZnJvbSAiZDMtdHJhbnNpdGlvbiI7CgpleHBvcnQgZGVmYXVsdCB7CiAgbmFtZTogIkNhbGwiLAogIHByb3BzOiB7CiAgICB0aXRsZTogU3RyaW5nLAogICAgeEtleTogU3RyaW5nLAogICAgeUtleTogU3RyaW5nLAogICAgZGF0YTogQXJyYXkKICB9LAogIG1vdW50ZWQoKSB7CiAgICB0aGlzLnN2Z1dpZHRoID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoImNvbnRhaW5lciIpLm9mZnNldFdpZHRoICogMC43NTsKICAgIHRoaXMuQWRkUmVzaXplTGlzdGVuZXIoKTsKICAgIHRoaXMuQW5pbWF0ZUxvYWQoKTsKICB9LAogIGRhdGE6ICgpID0+ICh7CiAgICBzdmdXaWR0aDogMCwKICAgIHJlZHJhd1RvZ2dsZTogdHJ1ZQogIH0pLAogIG1ldGhvZHM6IHsKICAgIC8vIOe7mOWItuafseW9ogogICAgQW5pbWF0ZUxvYWQoKSB7CiAgICAgIHNlbGVjdEFsbCgicmVjdCIpCiAgICAgICAgLmRhdGEodGhpcy5kYXRhKQogICAgICAgIC50cmFuc2l0aW9uKCkKICAgICAgICAuZGVsYXkoKGQsIGkpID0+IHsKICAgICAgICAgIHJldHVybiBpICogMTUwOwogICAgICAgIH0pCiAgICAgICAgLmR1cmF0aW9uKDEwMDApCiAgICAgICAgLmF0dHIoInkiLCBkID0+IHsKICAgICAgICAgIHJldHVybiB0aGlzLnlTY2FsZShkW3RoaXMueUtleV0pOwogICAgICAgIH0pCiAgICAgICAgLmF0dHIoImhlaWdodCIsIGQgPT4gewogICAgICAgICAgcmV0dXJuIHRoaXMuc3ZnSGVpZ2h0IC0gdGhpcy55U2NhbGUoZFt0aGlzLnlLZXldKTsKICAgICAgICB9KQogICAgICAgIC5kYXRhKHRoaXMuZGF0YSkKICAgICAgICAuZW50ZXIoKTsKICAgIH0sCiAgICAvLyDosIPmlbTnqpflj6PlpKflsI/lkI4zMDDmr6vnp5Lph43mlrDnu5jliLblm77ooagKICAgIC8vIOWNs+WTjeW6lOW8j+e7mOWItgogICAgQWRkUmVzaXplTGlzdGVuZXIoKSB7CiAgICAgIHdpbmRvdy5hZGRFdmVudExpc3RlbmVyKCJyZXNpemUiLCAoKSA9PiB7CiAgICAgICAgdGhpcy4kZGF0YS5yZWRyYXdUb2dnbGUgPSBmYWxzZTsKICAgICAgICBzZXRUaW1lb3V0KCgpID0+IHsKICAgICAgICAgIHRoaXMuJGRhdGEucmVkcmF3VG9nZ2xlID0gdHJ1ZTsKICAgICAgICAgIHRoaXMuJGRhdGEuc3ZnV2lkdGggPQogICAgICAgICAgICBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgiY29udGFpbmVyIikub2Zmc2V0V2lkdGggKiAwLjc1OwogICAgICAgICAgdGhpcy5BbmltYXRlTG9hZCgpOwogICAgICAgIH0sIDMwMCk7CiAgICAgIH0pOwogICAgICBjb25zb2xlLmxvZyh0aGlzLnN2Z1dpZHRoKTsKICAgIH0KICB9LAogIGNvbXB1dGVkOiB7CiAgICBkYXRhTWF4KCkgewogICAgICByZXR1cm4gbWF4KHRoaXMuZGF0YSwgZCA9PiB7CiAgICAgICAgcmV0dXJuIGRbdGhpcy55S2V5XTsKICAgICAgfSk7CiAgICB9LAogICAgZGF0YU1pbigpIHsKICAgICAgcmV0dXJuIG1pbih0aGlzLmRhdGEsIGQgPT4gewogICAgICAgIHJldHVybiBkW3RoaXMueUtleV07CiAgICAgIH0pOwogICAgfSwKICAgIHhTY2FsZSgpIHsKICAgICAgcmV0dXJuIHNjYWxlQmFuZCgpCiAgICAgICAgLnJhbmdlUm91bmQoWzAsIHRoaXMuc3ZnV2lkdGhdKQogICAgICAgIC5wYWRkaW5nKDAuMSkKICAgICAgICAuZG9tYWluKAogICAgICAgICAgdGhpcy5kYXRhLm1hcChkID0+IHsKICAgICAgICAgICAgcmV0dXJuIGRbdGhpcy54S2V5XTsKICAgICAgICAgIH0pCiAgICAgICAgKTsKICAgIH0sCiAgICAvLyDpgJrov4fnur/mgKfmr5TkvovlsLroh6rliqjnlJ/miJAKICAgIHlTY2FsZSgpIHsKICAgICAgcmV0dXJuIHNjYWxlTGluZWFyKCkKICAgICAgICAucmFuZ2VSb3VuZChbdGhpcy5zdmdIZWlnaHQsIDBdKQogICAgICAgIC5kb21haW4oW3RoaXMuZGF0YU1pbiA+IDAgPyAwIDogdGhpcy5kYXRhTWluICsgMiwgdGhpcy5kYXRhTWF4ICsgMl0pOwogICAgfSwKCiAgICBzdmdIZWlnaHQoKSB7CiAgICAgIHJldHVybiB0aGlzLnN2Z1dpZHRoIC8gMS42MTgwMzM5ODg3NTsgLy8g6buE6YeR5q+U5L6LCiAgICB9CiAgfQp9Owo="},{"version":3,"sources":["Call.vue"],"names":[],"mappings":";;;;;;;;;;;;;;;;;;;;;;;;;;;;AA4BA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA","file":"Call.vue","sourceRoot":"src/components","sourcesContent":["<template>\n  <div id=\"container\" class=\"svg-container\" align=\"center\">\n    <h1>{{ title }}</h1>\n    <svg v-if=\"redrawToggle === true\" :width=\"svgWidth\" :height=\"svgHeight\">\n      <g>\n        <text\n          v-for=\"item in data\"\n          :key=\"item[xKey].amount\"\n          :x=\"xScale(item[xKey]) + 30\"\n          :y=\"yScale(item[yKey]) - 2\"\n          fill=\"red\"\n        >{{ item[xKey]}} {{ item[yKey]}}</text>\n\n        <rect\n          v-for=\"item in data\"\n          class=\"bar-positive\"\n          :key=\"item[xKey]\"\n          :x=\"xScale(item[xKey])\"\n          :y=\"yScale(0)\"\n          :width=\"xScale.bandwidth()\"\n          :height=\"0\"\n        />\n      </g>\n    </svg>\n  </div>\n</template>\n\n<script>\nimport { scaleLinear, scaleBand } from \"d3-scale\";\nimport { max, min } from \"d3-array\";\nimport { selectAll } from \"d3-selection\";\nimport { transition } from \"d3-transition\";\n\nexport default {\n  name: \"Call\",\n  props: {\n    title: String,\n    xKey: String,\n    yKey: String,\n    data: Array\n  },\n  mounted() {\n    this.svgWidth = document.getElementById(\"container\").offsetWidth * 0.75;\n    this.AddResizeListener();\n    this.AnimateLoad();\n  },\n  data: () => ({\n    svgWidth: 0,\n    redrawToggle: true\n  }),\n  methods: {\n    // 绘制柱形\n    AnimateLoad() {\n      selectAll(\"rect\")\n        .data(this.data)\n        .transition()\n        .delay((d, i) => {\n          return i * 150;\n        })\n        .duration(1000)\n        .attr(\"y\", d => {\n          return this.yScale(d[this.yKey]);\n        })\n        .attr(\"height\", d => {\n          return this.svgHeight - this.yScale(d[this.yKey]);\n        })\n        .data(this.data)\n        .enter();\n    },\n    // 调整窗口大小后300毫秒重新绘制图表\n    // 即响应式绘制\n    AddResizeListener() {\n      window.addEventListener(\"resize\", () => {\n        this.$data.redrawToggle = false;\n        setTimeout(() => {\n          this.$data.redrawToggle = true;\n          this.$data.svgWidth =\n            document.getElementById(\"container\").offsetWidth * 0.75;\n          this.AnimateLoad();\n        }, 300);\n      });\n      console.log(this.svgWidth);\n    }\n  },\n  computed: {\n    dataMax() {\n      return max(this.data, d => {\n        return d[this.yKey];\n      });\n    },\n    dataMin() {\n      return min(this.data, d => {\n        return d[this.yKey];\n      });\n    },\n    xScale() {\n      return scaleBand()\n        .rangeRound([0, this.svgWidth])\n        .padding(0.1)\n        .domain(\n          this.data.map(d => {\n            return d[this.xKey];\n          })\n        );\n    },\n    // 通过线性比例尺自动生成\n    yScale() {\n      return scaleLinear()\n        .rangeRound([this.svgHeight, 0])\n        .domain([this.dataMin > 0 ? 0 : this.dataMin + 2, this.dataMax + 2]);\n    },\n\n    svgHeight() {\n      return this.svgWidth / 1.61803398875; // 黄金比例\n    }\n  }\n};\n</script>\n\n<style scoped>\n.bar-positive {\n  fill: steelblue;\n  transition: r 0.2s ease-in-out;\n}\n\n.bar-positive:hover {\n  fill: brown;\n}\n\n.svg-container {\n  display: inline-block;\n  position: relative;\n  width: 100%;\n  padding-bottom: 1%;\n  vertical-align: top;\n  overflow: hidden;\n}\n</style>\n"]}]}