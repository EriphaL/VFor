{"remainingRequest":"/Users/eripha/Desktop/project/routine/admin/node_modules/vue-loader/lib/index.js??vue-loader-options!/Users/eripha/Desktop/project/routine/admin/src/components/BarChart.vue?vue&type=style&index=0&id=22e0623b&scoped=true&lang=css&","dependencies":[{"path":"/Users/eripha/Desktop/project/routine/admin/src/components/BarChart.vue","mtime":1593395785985},{"path":"/Users/eripha/Desktop/project/routine/admin/node_modules/css-loader/dist/cjs.js","mtime":499162500000},{"path":"/Users/eripha/Desktop/project/routine/admin/node_modules/vue-loader/lib/loaders/stylePostLoader.js","mtime":499162500000},{"path":"/Users/eripha/Desktop/project/routine/admin/node_modules/postcss-loader/src/index.js","mtime":499162500000},{"path":"/Users/eripha/Desktop/project/routine/admin/node_modules/cache-loader/dist/cjs.js","mtime":499162500000},{"path":"/Users/eripha/Desktop/project/routine/admin/node_modules/vue-loader/lib/index.js","mtime":499162500000}],"contextDependencies":[],"result":[{"type":"Buffer","data":"base64:CgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKLmJhci1wb3NpdGl2ZSB7CiAgZmlsbDogc3RlZWxibHVlOwogIHRyYW5zaXRpb246IHIgMC4ycyBlYXNlLWluLW91dDsKfQoKLmJhci1wb3NpdGl2ZTpob3ZlciB7CiAgZmlsbDogYnJvd247Cn0KCi5zdmctY29udGFpbmVyIHsKICBkaXNwbGF5OiBpbmxpbmUtYmxvY2s7CiAgcG9zaXRpb246IHJlbGF0aXZlOwogIHdpZHRoOiAxMDAlOwogIHBhZGRpbmctYm90dG9tOiAxJTsKICB2ZXJ0aWNhbC1hbGlnbjogdG9wOwogIG92ZXJmbG93OiBoaWRkZW47Cn0K"},{"version":3,"sources":["BarChart.vue"],"names":[],"mappings":";;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;AAwHA;AACA;AACA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA","file":"BarChart.vue","sourceRoot":"src/components","sourcesContent":["<template>\n  <div id=\"container\" class=\"svg-container\" align=\"center\">\n    <h1>{{ title }}</h1>\n    <svg v-if=\"redrawToggle === true\" :width=\"svgWidth\" :height=\"svgHeight\">\n      <g>\n        <text\n          v-for=\"item in data\"\n          :key=\"item[xKey].amount\"\n          :x=\"xScale(item[xKey]) + 30\"\n          :y=\"yScale(item[yKey]) - 2\"\n          fill=\"red\"\n        >{{ item[xKey]}} {{ item[yKey]}}</text>\n\n        <rect\n          v-for=\"item in data\"\n          class=\"bar-positive\"\n          :key=\"item[xKey]\"\n          :x=\"xScale(item[xKey])\"\n          :y=\"yScale(0)\"\n          :width=\"xScale.bandwidth()\"\n          :height=\"0\"\n        />\n      </g>\n    </svg>\n  </div>\n</template>\n\n<script>\nimport { scaleLinear, scaleBand } from \"d3-scale\";\nimport { max, min } from \"d3-array\";\nimport { selectAll } from \"d3-selection\";\n// import { transition } from \"d3-transition\";\n\nexport default {\n  name: \"BarChart\",\n  props: {\n    title: String,\n    xKey: String,\n    yKey: String,\n    data: Array\n  },\n  mounted() {\n    this.svgWidth = document.getElementById(\"container\").offsetWidth * 0.75;\n    this.AddResizeListener();\n    this.AnimateLoad();\n  },\n  data: () => ({\n    svgWidth: 0,\n    redrawToggle: true\n  }),\n  methods: {\n    // 绘制柱形\n    AnimateLoad() {\n      selectAll(\"rect\")\n        .data(this.data)\n        .transition()\n        .delay((d, i) => {\n          return i * 150;\n        })\n        .duration(1000)\n        .attr(\"y\", d => {\n          return this.yScale(d[this.yKey]);\n        })\n        .attr(\"height\", d => {\n          return this.svgHeight - this.yScale(d[this.yKey]);\n        })\n        .data(this.data)\n        .enter();\n    },\n    // 调整窗口大小后300毫秒重新绘制图表\n    // 即响应式绘制\n    AddResizeListener() {\n      window.addEventListener(\"resize\", () => {\n        this.$data.redrawToggle = false;\n        setTimeout(() => {\n          this.$data.redrawToggle = true;\n          this.$data.svgWidth =\n            document.getElementById(\"container\").offsetWidth * 0.75;\n          this.AnimateLoad();\n        }, 300);\n      });\n      console.log(this.svgWidth);\n    }\n  },\n  computed: {\n    dataMax() {\n      return max(this.data, d => {\n        return d[this.yKey];\n      });\n    },\n    dataMin() {\n      return min(this.data, d => {\n        return d[this.yKey];\n      });\n    },\n    xScale() {\n      return scaleBand()\n        .rangeRound([0, this.svgWidth])\n        .padding(0.1)\n        .domain(\n          this.data.map(d => {\n            return d[this.xKey];\n          })\n        );\n    },\n    // 通过线性比例尺自动生成\n    yScale() {\n      return scaleLinear()\n        .rangeRound([this.svgHeight, 0])\n        .domain([this.dataMin > 0 ? 0 : this.dataMin + 2, this.dataMax + 2]);\n    },\n\n    svgHeight() {\n      return this.svgWidth / 1.61803398875; // 黄金比例\n    }\n  }\n};\n</script>\n\n<style scoped>\n.bar-positive {\n  fill: steelblue;\n  transition: r 0.2s ease-in-out;\n}\n\n.bar-positive:hover {\n  fill: brown;\n}\n\n.svg-container {\n  display: inline-block;\n  position: relative;\n  width: 100%;\n  padding-bottom: 1%;\n  vertical-align: top;\n  overflow: hidden;\n}\n</style>\n"]}]}